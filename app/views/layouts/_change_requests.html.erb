<h1>Change Requests</h1>

<% if change_requests.count > 0 %>
  <table>
    <thead>
      <th>Title</th>
      <th>Type</th>
      <th>Deadline</th>
      <th>Status</th>
      <th>Posted by</th>

      <% if current_user.Manager? %>
        <th>Assigned Developers</th>
      <% elsif current_user.Developer? %>

      <% elsif current_user.QualityAssurance? %>

      <% end %>

      <th colspan=3>Links</th>
    </thead>
    <tbody>
      <% change_requests.each do |change| %>
      <tr>
        <td><%= change.title%></td>
        <td><%= change.type%></td>
        <td><%= change.deadline%></td>
        <td><%= change.status%></td>
        <td><%= QualityAssurance.find(change.user_id).email%></td>

        <% if current_user.Manager? %>
          <td><%= change.developers.count %></td>
          <td><%= link_to 'show', manager_change_request_path(change) %></td>

        <% elsif current_user.Developer? %>
          <td><%= link_to 'show', developer_change_request_path(change) %></td></td>
          <% if change.developers.include? current_user %>
            <td>Assigned</td>
          <% else %>
            <td><%= link_to 'Assign', assign_developer_change_request_path(change), method: :post, data: {confirm: 'Are you sure?'}%></td>
          <% end %>

        <% elsif current_user.QualityAssurance? %>
          <td><%= link_to 'Show', quality_assurance_change_request_path(change) %></td>

        <% end %>

      </tr>
      <% end %>
    </tbody>
  </table>

<% else %>
  <h3>No Requested Changes</h3>
<% end %>
